

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>eqcorrscan.utils.clustering module &mdash; EQcorrscan 0.0.5 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/EQcorrscan_logo.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="EQcorrscan 0.0.5 documentation" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> EQcorrscan</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction to the EQcorrscan package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intro.html#functions">Functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">EQcorrscan tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial.html#match-filter-detection">Match-filter detection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial.html#references">References</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../core.html">Core</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../core.html#module-bright_lights">bright_lights</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core.html#module-template_gen">template_gen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core.html#module-match_filter">match_filter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core.html#module-lag_calc">lag_calc</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utils.html">Utils</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../utils.html#module-Sfile_util">Sfile_util</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html#module-findpeaks">findpeaks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html#module-clustering">clustering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html#module-pre_processing">pre_processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html#module-EQcorrscan_plotting">EQcorrscan_plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html#module-mag_calc">mag_calc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html#module-stacking">stacking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html#module-catalogue2DD">catalogue2DD</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../par.html">Par</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">EQcorrscan</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>eqcorrscan.utils.clustering module</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/source/eqcorrscan.utils.clustering.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="module-eqcorrscan.utils.clustering">
<span id="eqcorrscan-utils-clustering-module"></span><h1>eqcorrscan.utils.clustering module<a class="headerlink" href="#module-eqcorrscan.utils.clustering" title="Permalink to this headline">¶</a></h1>
<p>Code to compute the linkage between seismograms and cluster them accordingly</p>
<p>Written by Calum Chamberlain, in alpha stages of development as of 24/06/2015</p>
<p>Implimented to streamline templates after template detection in beamforming
methods, employed by implimentation of Frank et al. code.</p>
<p>As such this code is designed to work only for templates with the same channels</p>
<p>Copyright 2015 Calum Chamberlain</p>
<p>This file is part of EQcorrscan.</p>
<blockquote>
<div><p>EQcorrscan is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.</p>
<p>EQcorrscan is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.</p>
<p>You should have received a copy of the GNU General Public License
along with EQcorrscan.  If not, see &lt;<a class="reference external" href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>&gt;.</p>
</div></blockquote>
<dl class="function">
<dt id="eqcorrscan.utils.clustering.SVD">
<code class="descclassname">eqcorrscan.utils.clustering.</code><code class="descname">SVD</code><span class="sig-paren">(</span><em>templates</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/eqcorrscan/utils/clustering.html#SVD"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#eqcorrscan.utils.clustering.SVD" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to compute the SVD of a number of templates and return the singular
vectors and singular values of the templates.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>templates</strong> (<em>List of Obspy.Stream</em>) &#8211; List of the templates to be analysed</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">SVector(list of ndarray), SValues(list) for each channel,             Uvalues(list of ndarray) for each channel,             stachans, List of String (station.channel)</td>
</tr>
</tbody>
</table>
<p class="rubric">Note</p>
<p>It is recommended that you align the data before computing the SVD, e.g.,
the P-arrival on all templates for the same channel should appear at the same
time in the trace.</p>
</dd></dl>

<dl class="function">
<dt id="eqcorrscan.utils.clustering.SVD_2_stream">
<code class="descclassname">eqcorrscan.utils.clustering.</code><code class="descname">SVD_2_stream</code><span class="sig-paren">(</span><em>SVectors</em>, <em>stachans</em>, <em>k</em>, <em>sampling_rate</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/eqcorrscan/utils/clustering.html#SVD_2_stream"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#eqcorrscan.utils.clustering.SVD_2_stream" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to convert the singular vectors output by SVD to streams, one for
each singular vector level, for all channels.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>SVectors</strong> (<em>List of np.ndarray</em>) &#8211; Singular vectors</li>
<li><strong>stachans</strong> (<em>List of Strings</em>) &#8211; List of station.channel Strings</li>
<li><strong>k</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) &#8211; Number of streams to return = number of SV&#8217;s to include</li>
<li><strong>sampling_rate</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) &#8211; Sampling rate in Hz</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">SVstreams, List of Obspy.Stream, with SVStreams[0] being
composed of the highest rank singular vectors.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="eqcorrscan.utils.clustering.cluster">
<code class="descclassname">eqcorrscan.utils.clustering.</code><code class="descname">cluster</code><span class="sig-paren">(</span><em>templates</em>, <em>show=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/eqcorrscan/utils/clustering.html#cluster"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#eqcorrscan.utils.clustering.cluster" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to take a set of templates and cluster them, will return distance            matrix of grouped templates</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>templates</strong> (<em>List of Obspy.Stream</em>) &#8211; List of templates to compute clustering for</li>
<li><strong>show</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) &#8211; plot linkage on screen if True, defaults to True</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">List of cluster groups, array of length len(templates), with
each number relating to a cluster</p>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Note:
Not fully feautured yet, returns the Z matrix, but doesn&#8217;t tell you what        can be clustered.</p>
</dd></dl>

<dl class="function">
<dt id="eqcorrscan.utils.clustering.corr_cluster">
<code class="descclassname">eqcorrscan.utils.clustering.</code><code class="descname">corr_cluster</code><span class="sig-paren">(</span><em>traces</em>, <em>thresh=0.9</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/eqcorrscan/utils/clustering.html#corr_cluster"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#eqcorrscan.utils.clustering.corr_cluster" title="Permalink to this definition">¶</a></dt>
<dd><p>Group traces based on correlations above threshold with the stack - will
run twice, once with a lower threshold, then again with your threshold to
remove large outliers</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>traces</strong> (<em>List of :class:obspy.Trace</em>) &#8211; Traces to compute similarity between</li>
<li><strong>thrsh</strong> &#8211; Correlation threshold between -1-1</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">np.ndarray of bool</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="eqcorrscan.utils.clustering.cross_chan_coherence">
<code class="descclassname">eqcorrscan.utils.clustering.</code><code class="descname">cross_chan_coherence</code><span class="sig-paren">(</span><em>st1</em>, <em>st2</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/eqcorrscan/utils/clustering.html#cross_chan_coherence"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#eqcorrscan.utils.clustering.cross_chan_coherence" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to determine the cross-channel coherancy between two streams of
multichannel seismic data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>st1</strong> (<em>obspy Stream</em>) &#8211; Stream one</li>
<li><strong>st2</strong> (<em>obspy Stream</em>) &#8211; Stream two</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">cross channel coherence, float - normalized by number of channels</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="eqcorrscan.utils.clustering.distance_matrix">
<code class="descclassname">eqcorrscan.utils.clustering.</code><code class="descname">distance_matrix</code><span class="sig-paren">(</span><em>templates</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/eqcorrscan/utils/clustering.html#distance_matrix"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#eqcorrscan.utils.clustering.distance_matrix" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to compute the distance matrix for all templates - will give
distance as 1-abs(cccoh), e.g. a well correlated pair of templates will
have small distances, and an equally well correlated reverse image will
have the same distance as apositively correlated image - this is an issue</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>template</strong> &#8211; List of the streams to compute the distance matrix for</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">ndarray - distance matrix</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="eqcorrscan.utils.clustering.empirical_SVD">
<code class="descclassname">eqcorrscan.utils.clustering.</code><code class="descname">empirical_SVD</code><span class="sig-paren">(</span><em>templates</em>, <em>linear=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/eqcorrscan/utils/clustering.html#empirical_SVD"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#eqcorrscan.utils.clustering.empirical_SVD" title="Permalink to this definition">¶</a></dt>
<dd><p>Empirical subspace detector generation function.  Takes a list of templates
and computes the stack as the first order subspace detector, and the
differential of this as the second order subspace detector following
the emprical subspace method of Barrett &amp; Beroza, 2014 - SRL.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>templates</strong> (<em>list of stream</em>) &#8211; list of template streams to compute the subspace detectors        from</li>
<li><strong>linear</strong> (<em>Bool</em>) &#8211; Set to true by default to compute the linear stack as the        first subspace vector, False will use the phase-weighted stack as the        first subspace vector.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">list of two streams</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="eqcorrscan.utils.clustering.extract_detections">
<code class="descclassname">eqcorrscan.utils.clustering.</code><code class="descname">extract_detections</code><span class="sig-paren">(</span><em>detections</em>, <em>templates</em>, <em>extract_len=90.0</em>, <em>outdir=None</em>, <em>extract_Z=True</em>, <em>additional_stations=[]</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/eqcorrscan/utils/clustering.html#extract_detections"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#eqcorrscan.utils.clustering.extract_detections" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to extract the waveforms associated with each detection in a list
of detections for the template, template.  Waveforms will be returned as
a list of obspy.Streams containing segments of extract_len.  They will also
be saved if outdir is set.  The default is unset.  The default extract_len
is 90 seconds per channel.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>detections</strong> (<em>List tuple of of :class: datetime.datetime, string</em>) &#8211; List of datetime objects, and their associated template            name</li>
<li><strong>templates</strong> (<em>List of tuple of string and :class: obspy.Stream</em>) &#8211; A list of the tuples of the template name and the template            Stream used to detect detections.</li>
<li><strong>extract_len</strong> (<a class="reference external" href="https://docs.python.org/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) &#8211; Length to extract around the detection (will be equally            cut around the detection time) in seconds.  Default is 90.0.</li>
<li><strong>outdir</strong> (<em>Bool or String</em>) &#8211; Default is None, with None set, no files will be saved,            if set each detection will be saved into this directory with files            named according to the detection time, NOT than the waveform            start time. Detections will be saved into template subdirectories.</li>
<li><strong>extract_Z</strong> (<em>Bool</em>) &#8211; Set to True to also extract Z channels for detections            delays will be the same as horizontal channels, only applies if            only horizontal channels were used in the template.</li>
<li><strong>additional_stations</strong> (<em>List of tuple</em>) &#8211; List of stations, chanels and networks to also            extract data for using an average delay.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">List of :class: obspy.Stream</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="eqcorrscan.utils.clustering.group_delays">
<code class="descclassname">eqcorrscan.utils.clustering.</code><code class="descname">group_delays</code><span class="sig-paren">(</span><em>templates</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/eqcorrscan/utils/clustering.html#group_delays"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#eqcorrscan.utils.clustering.group_delays" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to group template waveforms according to their delays</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>templates</strong> (<em>List of obspy.Stream</em>) &#8211; List of the waveforms you want to group</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">List of List of obspy.Streams where each initial list is a group            with the same delays</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Calum John Chamberlain.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.0.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>